<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monthly Donation Form</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    /* All your original CSS unchanged */
    /* Example base styles */
    body {
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      background: #f8f9fa;
      margin: 0;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 15px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ced4da;
      font-size: 16px;
    }
    button {
      background: #28a745;
      color: #fff;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    /* Add other CSS from your original code as-is */
  </style>
</head>
<body>
<div class="container">
  <form id="payment-form">
    <!-- Header -->
    <div class="header" style="display: flex; flex-direction: column; align-items: center; text-align: center; gap: 10px;">
      <h1>Monthly donation</h1>
      <p>Support our mission with a recurring monthly contribution</p>
    </div>

    <!-- Donation Amount -->
    <div class="section-title"><i class="fas fa-money-bill-wave"></i> Choose your donation amount</div>
    <div class="donation-amounts">
      <div class="donation-option active" data-value="10">€10/month</div>
      <div class="donation-option" data-value="25">€25/month</div>
      <div class="donation-option" data-value="50">€50/month</div>
      <div class="donation-option" data-value="100">€100/month</div>
      <div class="donation-option" data-value="other">Other amount</div>
    </div>
    <div class="other-amount-container" id="other-amount-container">
      <input type="number" id="custom-amount" placeholder="Enter amount" min="1" step="0.01">
    </div>

    <!-- Personal Info -->
    <div class="form-group"><label for="donation-by">Donation by (optional)</label><input type="text" id="donation-by" placeholder="In memory of..."></div>
    <div class="form-group"><label for="name">Full Name</label><input type="text" id="name" placeholder="Your name" required></div>
    <div class="form-group"><label for="email">Email</label><input type="email" id="email" placeholder="your.email@example.com" required></div>
    <div class="form-group"><label for="phone">Phone (optional)</label><input type="tel" id="phone" placeholder="+33 6 12 34 56 78"></div>

    <!-- Billing Address -->
    <div class="form-group"><label for="line1">Street Address</label><input type="text" id="line1" placeholder="Av. Gustave Eiffel" required></div>
    <div class="form-group"><label for="line2">Apt/Suite (optional)</label><input type="text" id="line2" placeholder="Building 12"></div>
    <div class="form-row" style="display: flex; gap: 10px;">
      <input type="text" id="city" placeholder="City" required>
      <input type="text" id="state" placeholder="State/Province">
    </div>
    <div class="form-row" style="display: flex; gap: 10px;">
      <input type="text" id="postal_code" placeholder="Postal Code" required>
      <select id="country" required>
        <option value="">Select country</option>
        <option value="FR" selected>France</option>
        <option value="DE">Germany</option>
        <option value="IT">Italy</option>
        <option value="ES">Spain</option>
      </select>
    </div>

    <!-- Payment Info -->
    <div class="form-group"><label for="card-element">Card Details</label><div id="card-element"></div></div>
    <div class="form-group"><label for="card-name">Cardholder Name</label><input type="text" id="card-name" required></div>
    <div class="form-group"><div id="card-errors" role="alert" style="color:red;"></div></div>

    <button id="submit-button" type="submit">Donate €10/month</button>
  </form>
</div>

<script>
const stripe = Stripe('pk_test_51S1OAH3pBglTeA0mBud6ByC3NIv6nMTrQ4ITBQ1h1GDTBX5ygMuoeCVeBZdF1Jy5wmQq819Xbd4kKRjZ3aJJcDfu00dGiF5MC6');
const elements = stripe.elements();
const card = elements.create('card', { hidePostalCode: true });
card.mount('#card-element');

const donationOptions = document.querySelectorAll('.donation-option');
const otherAmountContainer = document.getElementById('other-amount-container');
const customAmountInput = document.getElementById('custom-amount');
const button = document.getElementById('submit-button');
const cardErrors = document.getElementById('card-errors');

donationOptions.forEach(opt => opt.addEventListener('click', function(){
  donationOptions.forEach(o => o.classList.remove('active'));
  this.classList.add('active');
  if(this.dataset.value==='other') otherAmountContainer.style.display='block';
  else otherAmountContainer.style.display='none';
  updateButton();
}));

customAmountInput.addEventListener('input', updateButton);

function getSelectedAmount(){
  const active = document.querySelector('.donation-option.active');
  if(active.dataset.value==='other') return parseFloat(customAmountInput.value)||0;
  return parseFloat(active.dataset.value);
}

function updateButton(){
  const amount = getSelectedAmount();
  button.textContent = amount>0?`Donate €${amount}/month`:'Enter amount';
}

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const amount = getSelectedAmount();
  if(amount<=0) return alert('Please enter a valid amount');

  button.disabled=true;
  button.textContent='Processing...';

  const { error: pmError, paymentMethod } = await stripe.createPaymentMethod({
    type:'card',
    card,
    billing_details:{
      name:document.getElementById('card-name').value,
      email:document.getElementById('email').value,
      phone:document.getElementById('phone').value,
      address:{
        line1:document.getElementById('line1').value,
        line2:document.getElementById('line2').value,
        city:document.getElementById('city').value,
        state:document.getElementById('state').value,
        postal_code:document.getElementById('postal_code').value,
        country:document.getElementById('country').value
      }
    }
  });

  if(pmError){ cardErrors.textContent=pmError.message; button.disabled=false; button.textContent=`Donate €${amount}/month`; return;}

  try {
    const res = await fetch('/.netlify/functions/create-subscription',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        amount:Math.round(amount*100),
        currency:'eur',
        donation_by:document.getElementById('donation-by').value,
        name:document.getElementById('name').value,
        email:document.getElementById('email').value,
        phone:document.getElementById('phone').value,
        address:{
          line1:document.getElementById('line1').value,
          line2:document.getElementById('line2').value,
          city:document.getElementById('city').value,
          state:document.getElementById('state').value,
          postal_code:document.getElementById('postal_code').value,
          country:document.getElementById('country').value
        },
        paymentMethodId:paymentMethod.id
      })
    });

    const data = await res.json();
    if(!res.ok) throw new Error(data.error||'Failed to create subscription');

    if(data.status==='requires_action'){
      const {error: confirmError} = await stripe.confirmCardPayment(data.clientSecret);
      if(confirmError) throw new Error(confirmError.message);
    }

    sessionStorage.setItem('paymentDetails',JSON.stringify({
      amount,
      name:document.getElementById('name').value,
      email:document.getElementById('email').value,
      donationBy:document.getElementById('donation-by').value||'',
      subscriptionId:data.subscriptionId,
      isMonthly:true
    }));
    window.location.href='success_confirmation.html';

  } catch(err){
    cardErrors.textContent=err.message;
    button.disabled=false;
    button.t
